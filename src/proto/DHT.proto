syntax = "proto3";

package protoBuffer;
option go_package = "src/proto/stubs";

message NodeInfo {
  string id = 1;
  string host = 2;
  string port = 3;
}

message Resource {
  string key = 1;
  string value = 2;
}


//Servizi JOIN/LEAVE

message JoinRequest {
  string Host = 1;
  string Port = 2;
  string next = 3;
}

message JoinResponse {
  string status = 1;
  repeated NodeInfo childs = 2;
  repeated NodeInfo nephews = 3;
}

message LeaveRequest {
  NodeInfo nodeToLeave = 1;
  repeated NodeInfo childs = 2;
  repeated NodeInfo nephews = 3;
  repeated Resource resources = 4;
}

message LeaveResponse {
  string status = 1;
}


//Servizi PUT/GET (risorse)

message PutRequest {
  Resource resource = 1;
  string next = 2;
}

message PutResponse {
  string status = 2;
}

message GetRequest {
  string key = 1;
  string next = 2;
}

message GetResponse {
  Resource resource = 1;
  string status = 2;
}

message ChangeParentRequest {
  NodeInfo new_parent = 1;
}

message ChangeParentResponse {
  string status = 1;
}



service DHT{
  //JOIN / LEAVE
  rpc JoinNode(JoinRequest) returns (JoinResponse);
  rpc LeaveNode(LeaveRequest) returns (LeaveResponse);

  //PUT / GET
  rpc PutResource(PutRequest) returns (PutResponse);
  rpc GetResource(GetRequest) returns (GetResponse);

  //Custodia
  rpc ChangeParent(ChangeParentRequest) returns (ChangeParentResponse);

}